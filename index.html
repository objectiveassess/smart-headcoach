<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>⚽ 다이아몬드 4-4-2 자동 배정</title>
<style>
  body {
    font-family: 'Noto Sans KR', sans-serif;
    background-color: #0b1622;
    color: #f0f6fc;
    text-align: center;
    margin: 0;
    padding: 0;
  }

  h1 {
    color: #00ff95;
    margin-top: 20px;
  }

  button {
    margin-top: 20px;
    padding: 10px 20px;
    background: #00ff95;
    border: none;
    border-radius: 6px;
    color: #0b1622;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
  }

  button:hover {
    background: #00e089;
  }

  #result {
    margin-top: 25px;
    font-size: 1.1rem;
    line-height: 1.6;
  }

  #score {
    margin-top: 15px;
    font-size: 0.9rem;
    color: #00ff95;
    opacity: 0.8;
  }

  /* 광고 모달 */
  .popup {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    visibility: hidden;
    opacity: 0;
    transition: opacity 0.4s ease, visibility 0.4s ease;
  }

  .popup.active {
    visibility: visible;
    opacity: 1;
  }

  .popup-content {
    background: #111c2b;
    color: #00ff95;
    padding: 40px;
    border-radius: 10px;
    box-shadow: 0 0 15px #00ff95;
    text-align: center;
    font-size: 1.2rem;
    animation: fadeIn 0.5s ease;
  }

  .popup-content button {
    margin-top: 20px;
    padding: 8px 18px;
    background: #00ff95;
    border: none;
    color: #0b1622;
    font-weight: bold;
    cursor: pointer;
    border-radius: 6px;
    transition: 0.3s;
  }

  .popup-content button:hover {
    background: #00e089;
  }

  @keyframes fadeIn {
    from { transform: scale(0.9); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }
</style>
</head>
<body>

<h1>⚽ 다이아몬드 4-4-2 자동 배정</h1>
<button onclick="generateFormation()">포메이션 생성</button>
<div id="result"></div>
<div id="score"></div>

<!-- 광고 팝업 -->
<div id="popup" class="popup">
  <div class="popup-content">
    <p>It’s okay though<br><strong>- 도사컴퍼니</strong></p>
    <button onclick="closePopup()">닫기</button>
  </div>
</div>

<script>
const players = [
  { name: "민수", pos1: "ST", pos2: "CAM", count: 0 },
  { name: "철수", pos1: "CDM", pos2: "CB", count: 0 },
  { name: "영호", pos1: "LB", pos2: "CB", count: 0 },
  { name: "진우", pos1: "RB", pos2: "RM", count: 0 },
  { name: "현수", pos1: "CAM", pos2: "CM", count: 0 },
  { name: "준호", pos1: "CB", pos2: "LB", count: 0 },
  { name: "도윤", pos1: "GK", pos2: "CB", count: 0 },
  { name: "태호", pos1: "ST", pos2: "LW", count: 0 },
  { name: "기훈", pos1: "CM", pos2: "CDM", count: 0 },
  { name: "상민", pos1: "RW", pos2: "ST", count: 0 },
];

const similarPositions = {
  ST: ["CAM", "RW", "LW"],
  CAM: ["CM", "ST"],
  CM: ["CAM", "CDM"],
  CDM: ["CM", "CB"],
  CB: ["CDM", "LB", "RB"],
  LB: ["CB", "LM"],
  RB: ["CB", "RM"],
  LM: ["LW", "CM"],
  RM: ["RW", "CM"],
  GK: []
};

let lastFormation = null;
let bestScore = -Infinity;

function generateFormation() {
  const formation = createRandomFormation(players);
  const score = evaluateFormation(formation);

  // 새 조합이 더 좋으면 갱신
  if (score >= bestScore) {
    bestScore = score;
    lastFormation = formation;
  }

  displayFormation(lastFormation);
  showPopup();
}

function createRandomFormation(pool) {
  const formationPositions = ["GK", "LB", "CB", "CB", "RB", "CDM", "CAM", "LM", "RM", "ST", "ST"];
  const used = new Set();
  const result = [];

  for (let pos of formationPositions) {
    const candidates = pool.filter(p => !used.has(p.name))
      .sort((a, b) => {
        // 공평성(출전횟수) 우선
        if (a.count !== b.count) return a.count - b.count;
        // 선호도 우선
        if (a.pos1 === pos) return -1;
        if (b.pos1 === pos) return 1;
        if (a.pos2 === pos) return -1;
        if (b.pos2 === pos) return 1;
        // 유사 포지션 고려
        if (similarPositions[a.pos1]?.includes(pos)) return -1;
        if (similarPositions[b.pos1]?.includes(pos)) return 1;
        return 0;
      });

    const chosen = candidates[0];
    if (chosen) {
      used.add(chosen.name);
      chosen.count++;
      result.push({ pos, name: chosen.name });
    }
  }
  return result;
}

// 배정된 포메이션 평가 함수
function evaluateFormation(formation) {
  let score = 0;
  for (const f of formation) {
    const p = players.find(pl => pl.name === f.name);
    if (p.pos1 === f.pos) score += 3;
    else if (p.pos2 === f.pos) score += 2;
    else if (similarPositions[p.pos1]?.includes(f.pos)) score += 1;
  }
  return score;
}

// 결과 표시
function displayFormation(formation) {
  const div = document.getElementById("result");
  div.innerHTML = "<h3>이번 포메이션</h3>" + 
    formation.map(f => `${f.pos}: ${f.name}`).join("<br>");

  const scoreDiv = document.getElementById("score");
  scoreDiv.innerHTML = `현재 최적 점수: <strong>${bestScore}</strong>점`;
}

// 광고 팝업 제어
function showPopup() {
  const popup = document.getElementById('popup');
  popup.classList.add('active');
  setTimeout(closePopup, 5000);
}
function closePopup() {
  document.getElementById('popup').classList.remove('active');
}

// 페이지 로드시 2초 후 자동 팝업
window.addEventListener('load', () => {
  setTimeout(showPopup, 2000);
});
</script>
</body>
</html>
