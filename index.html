<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>âš½ ì¡°ê¸°ì¶•êµ¬ 4ì¿¼í„° í¬ë©”ì´ì…˜ ìë™ ë°°ì •</title>
<style>
body {
  font-family: 'Noto Sans KR', sans-serif;
  background: #0b1622;
  color: #f0f6fc;
  margin: 0;
  padding: 0;
}
.container {
  max-width: 900px;
  margin: 30px auto;
  background: rgba(255,255,255,0.05);
  border-radius: 10px;
  padding: 20px;
}
h1 {
  text-align: center;
  color: #00c896;
}
input, select, button {
  padding: 8px;
  border-radius: 6px;
  border: none;
  margin: 4px;
}
input, select {
  width: 100%;
}
button {
  background: #00c896;
  color: #0b1622;
  font-weight: 600;
  cursor: pointer;
}
button:hover {
  background: #00e6aa;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
  font-size: 14px;
}
th, td {
  padding: 8px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  text-align: left;
}
.quarter {
  margin-top: 25px;
  background: rgba(255,255,255,0.03);
  border-radius: 8px;
  padding: 10px;
}
.flex {
  display: flex;
  gap: 6px;
  align-items: center;
}
.bar {
  height: 12px;
  background: #00c896;
  border-radius: 4px;
}
#popup {
  position: fixed;
  top: 20px;
  right: 20px;
  background: rgba(0,200,150,0.95);
  color: #0b1622;
  padding: 15px 20px;
  border-radius: 10px;
  font-weight: bold;
  display: none;
  z-index: 1000;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
}
</style>
</head>
<body>
<div class="container">
  <h1>âš½ ì¡°ê¸°ì¶•êµ¬ 4ì¿¼í„° ìë™ ë°°ì • (Diamond 4-4-2)</h1>
  <p>ì´ë¦„ê³¼ í¬ì§€ì…˜ì„ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ ì¿¼í„°ë³„ í¬ë©”ì´ì…˜ì„ ìƒì„±í•©ë‹ˆë‹¤.<br>
  ğŸ§¤ ê³¨í‚¤í¼ëŠ” 4ì¿¼í„° ì „ë¶€ ê³ ì •, ë‚˜ë¨¸ì§€ëŠ” 2~3ì¿¼í„°ì”©ë§Œ ë°°ì •ë©ë‹ˆë‹¤.</p>

  <div id="player-inputs"></div>
  <button onclick="addPlayer()">+ ì„ ìˆ˜ ì¶”ê°€</button>
  <button onclick="generateSchedule()">âœ… í¬ë©”ì´ì…˜ ìƒì„±</button>

  <div id="result"></div>
</div>

<div id="popup">Itâ€™s okay though - ë„ì‚¬ì»´í¼ë‹ˆ</div>

<script>
let players = [];

function addPlayer() {
  const div = document.createElement('div');
  div.className = 'flex';
  div.innerHTML = `
    <input type="text" placeholder="ì´ë¦„" class="name">
    <select class="pos1">
      <option value="">1ìˆœìœ„ í¬ì§€ì…˜</option>
      <option>GK</option><option>CB</option><option>RB</option><option>LB</option>
      <option>CDM</option><option>CM</option><option>CAM</option>
      <option>ST</option><option>RW</option><option>LW</option>
    </select>
    <select class="pos2">
      <option value="">2ìˆœìœ„ í¬ì§€ì…˜</option>
      <option>GK</option><option>CB</option><option>RB</option><option>LB</option>
      <option>CDM</option><option>CM</option><option>CAM</option>
      <option>ST</option><option>RW</option><option>LW</option>
    </select>
  `;
  document.getElementById('player-inputs').appendChild(div);
}

function generateSchedule() {
  showPopup();

  players = [];
  const rows = document.querySelectorAll('#player-inputs .flex');
  rows.forEach(r => {
    const name = r.querySelector('.name').value.trim();
    const pos1 = r.querySelector('.pos1').value;
    const pos2 = r.querySelector('.pos2').value;
    if (name) players.push({ name, pos1, pos2, count: 0, lastPlayed: -1 });
  });

  if (players.length < 11) {
    alert('âš ï¸ ìµœì†Œ 11ëª… ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”!');
    return;
  }

  const gk = players.find(p => p.pos1 === 'GK' || p.pos2 === 'GK');
  if (!gk) {
    alert('âš ï¸ ê³¨í‚¤í¼(GK)ê°€ ë°˜ë“œì‹œ 1ëª… ì´ìƒ í•„ìš”í•©ë‹ˆë‹¤!');
    return;
  }

  const GK = gk.name;
  gk.count = 4;
  gk.lastPlayed = 0;

  const fieldPlayers = players.filter(p => p.name !== GK);
  const quarters = [[], [], [], []];

  const formation = {
    defenders: ['CB', 'CB', 'RB', 'LB'],
    mids: ['CDM', 'CM', 'CM', 'CAM'],
    forwards: ['ST', 'ST']
  };

  const similar = {
    GK: [],
    CB: ['RB', 'LB'],
    RB: ['RW'],
    LB: ['LW'],
    CDM: ['CM'],
    CM: ['RM', 'LM'],
    CAM: ['CM'],
    RW: ['ST'],
    LW: ['ST'],
    ST: ['LW', 'RW']
  };

  let success = false;
  let ATTEMPTS = 1000;

  while (!success && ATTEMPTS <= 5000) {
    success = tryGenerate(fieldPlayers.map(p => ({...p})), quarters, GK, formation, similar);
    if (!success) ATTEMPTS += 1000;
  }

  if (!success) {
    alert(`âš ï¸ ìœ íš¨í•œ ë°°ì •ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\n\nê°€ëŠ¥ ì›ì¸:\nâ€¢ í¬ì§€ì…˜ë³„ ì¸ì› ë¶ˆê· í˜• (ì˜ˆ: ê³µê²©ìˆ˜ ë¶€ì¡± ë“±)\nâ€¢ 'ëª¨ë“  ì„ ìˆ˜ 2~3ì¿¼í„°' ì¡°ê±´ì„ ë§Œì¡±í•˜ì§€ ì•ŠëŠ” ì„ ìˆ˜ìˆ˜\n\ní•´ê²°: ì„ ìˆ˜ í¬ì§€ì…˜ì„ ì¡°ì •í•˜ê±°ë‚˜ 'ì‹œë„ ìˆ˜'ë¥¼ ëŠ˜ë ¤ë³´ì„¸ìš”.`);
    return;
  }

  displayResult(quarters);
}

function tryGenerate(fieldPlayers, quarters, GK, formation, similar) {
  for (let q = 0; q < 4; q++) {
    const lineup = [];
    lineup.push({ pos: 'GK', name: GK });

    if (!assignGroup(lineup, fieldPlayers, formation.defenders, q, similar)) return false;
    if (!assignGroup(lineup, fieldPlayers, formation.mids, q, similar)) return false;
    if (!assignGroup(lineup, fieldPlayers, formation.forwards, q, similar)) return false;

    quarters[q] = lineup;
  }

  // ëª¨ë“  ì„ ìˆ˜ 2~3ì¿¼í„° ì¡°ê±´ í™•ì¸
  return fieldPlayers.every(p => p.count >= 2 && p.count <= 3);
}

function assignGroup(lineup, pool, positions, q, similar) {
  for (let pos of positions) {
    let candidates = pool.filter(p => 
      p.count < 3 &&
      q - p.lastPlayed > 0 && // ì—°ì† 3ì¿¼í„° ë°©ì§€
      matchScore(p, pos, similar) > 0
    );

    candidates.sort((a, b) => {
      const aScore = matchScore(a, pos, similar);
      const bScore = matchScore(b, pos, similar);
      if (a.count !== b.count) return a.count - b.count;
      return bScore - aScore;
    });

    const pick = candidates[0];
    if (!pick) return false;

    lineup.push({ pos, name: pick.name });
    pick.count++;
    pick.lastPlayed = q;
  }
  return true;
}

function matchScore(player, pos, similar) {
  if (player.pos1 === pos) return 3;
  if (player.pos2 === pos) return 2;
  if (similar[player.pos1]?.includes(pos) || similar[player.pos2]?.includes(pos)) return 1;
  return 0;
}

function displayResult(quarters) {
  let html = '';
  for (let i = 0; i < 4; i++) {
    html += `<div class="quarter"><h3>ğŸ•’ ${i+1}ì¿¼í„°</h3><table><tr><th>í¬ì§€ì…˜</th><th>ì´ë¦„</th></tr>`;
    quarters[i].forEach(p => {
      html += `<tr><td>${p.pos}</td><td>${p.name}</td></tr>`;
    });
    html += '</table></div>';
  }

  html += '<h3>âš–ï¸ ì¶œì „ ì¿¼í„° ìš”ì•½</h3><table><tr><th>ì´ë¦„</th><th>ì¶œì „ ìˆ˜</th><th>ê·¸ë˜í”„</th></tr>';
  players.forEach(p => {
    const width = (p.count / 3) * 100;
    html += `<tr><td>${p.name}</td><td>${p.count}</td><td><div class="bar" style="width:${width}%"></div></td></tr>`;
  });
  html += '</table>';

  document.getElementById('result').innerHTML = html;
}

function showPopup() {
  const popup = document.getElementById('popup');
  popup.style.display = 'block';
  setTimeout(() => popup.style.display = 'none', 5000);
}
</script>
</body>
</html>
