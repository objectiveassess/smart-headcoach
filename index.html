<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì¡°ê¸°ì¶•êµ¬ 4ì¿¼í„° ìë™ ë°°ì • (Diamond 4-4-2)</title>
<style>
body {
  font-family: 'Noto Sans KR', sans-serif;
  background: #0b1622;
  color: #f0f6fc;
  margin: 0;
  padding: 0;
}
.container {
  max-width: 900px;
  margin: 30px auto;
  background: rgba(255,255,255,0.05);
  border-radius: 10px;
  padding: 20px;
}
h1 {
  text-align: center;
  color: #00c896;
}
input, select, button {
  padding: 8px;
  border-radius: 6px;
  border: none;
  margin: 4px;
}
input, select {
  width: 100%;
}
button {
  background: #00c896;
  color: #0b1622;
  font-weight: 600;
  cursor: pointer;
}
button:hover {
  background: #00e6aa;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
  font-size: 14px;
}
th, td {
  padding: 8px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  text-align: left;
}
.quarter {
  margin-top: 25px;
  background: rgba(255,255,255,0.03);
  border-radius: 8px;
  padding: 10px;
}
.flex {
  display: flex;
  gap: 6px;
  align-items: center;
}
.bar {
  height: 14px;
  background: #00c896;
  border-radius: 4px;
}
</style>
</head>
<body>
<div class="container">
  <h1>âš½ ì¡°ê¸°ì¶•êµ¬ 4ì¿¼í„° ìë™ ë°°ì • (Diamond 4-4-2)</h1>
  <p>ì´ë¦„ê³¼ í¬ì§€ì…˜ì„ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ ì¿¼í„°ë³„ í¬ë©”ì´ì…˜ì„ ìƒì„±í•©ë‹ˆë‹¤.<br>
  ğŸ§¤ ê³¨í‚¤í¼ëŠ” 4ì¿¼í„° ì „ë¶€ ê³ ì •, ë‚˜ë¨¸ì§€ëŠ” 3ì¿¼í„° ì´í•˜ë§Œ ë°°ì •ë©ë‹ˆë‹¤.</p>

  <div id="player-inputs"></div>
  <button onclick="addPlayer()">+ ì„ ìˆ˜ ì¶”ê°€</button>
  <button onclick="generateSchedule()">âœ… í¬ë©”ì´ì…˜ ìƒì„±</button>

  <div id="result"></div>
</div>

<script>
let players = [];
let popupShown = false;

// í¬ì§€ì…˜ ìœ ì‚¬ë„ ë§¤í•‘
const similarPositions = {
  'CB': ['CDM','RB','LB'],
  'RB': ['RW','CB'],
  'LB': ['LW','CB'],
  'CDM': ['CB','CM'],
  'CM': ['CDM','CAM','RM','LM'],
  'CAM': ['CM'],
  'ST': ['RW','LW'],
  'RW': ['ST','RB'],
  'LW': ['ST','LB'],
  'GK': []
};

function addPlayer() {
  const div = document.createElement('div');
  div.className = 'flex';
  div.innerHTML = `
    <input type="text" placeholder="ì´ë¦„" class="name">
    <select class="pos1">
      <option value="">1ìˆœìœ„ í¬ì§€ì…˜</option>
      <option>GK</option><option>CB</option><option>RB</option><option>LB</option>
      <option>CDM</option><option>CM</option><option>CAM</option>
      <option>ST</option><option>RW</option><option>LW</option>
    </select>
    <select class="pos2">
      <option value="">2ìˆœìœ„ í¬ì§€ì…˜</option>
      <option>GK</option><option>CB</option><option>RB</option><option>LB</option>
      <option>CDM</option><option>CM</option><option>CAM</option>
      <option>ST</option><option>RW</option><option>LW</option>
    </select>
    <button onclick="this.parentElement.remove()">âŒ</button>
  `;
  document.getElementById('player-inputs').appendChild(div);
}

function generateSchedule() {
  // íŒì—… í•œ ë²ˆë§Œ ë„ìš°ê¸°
  if (!popupShown) {
    alert("Itâ€™s okay though - ë„ì‚¬ì»´í¼ë‹ˆ âš½\n\në‹¹ì‹ ì˜ íŒ€ ë°°ì •ì„ ì±…ì„ì§‘ë‹ˆë‹¤!");
    popupShown = true;
  }

  players = [];
  const rows = document.querySelectorAll('#player-inputs .flex');
  rows.forEach(r => {
    const name = r.querySelector('.name').value.trim();
    const pos1 = r.querySelector('.pos1').value;
    const pos2 = r.querySelector('.pos2').value;
    if (name) players.push({ name, pos1, pos2, count: 0 });
  });

  if (players.length < 11) {
    alert('ìµœì†Œ 11ëª… ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”!');
    return;
  }

  const gk = players.find(p => p.pos1 === 'GK' || p.pos2 === 'GK');
  if (!gk) {
    alert('ê³¨í‚¤í¼(GK)ê°€ ë°˜ë“œì‹œ 1ëª… ì´ìƒ í•„ìš”í•©ë‹ˆë‹¤!');
    return;
  }

  const GK = gk.name;
  gk.count = 4;
  const fieldPlayers = players.filter(p => p.name !== GK);

  // í¬ë©”ì´ì…˜ êµ¬ì¡°
  const formation = [
    ['GK'],
    ['LB','CB','CB','RB'],
    ['CDM','CM','CAM','CM'],
    ['ST','ST']
  ];

  const quarters = [[],[],[],[]];

  for (let q = 0; q < 4; q++) {
    const lineup = [{pos:'GK', name:GK}];
    const used = new Set([GK]);

    // ê° í¬ì§€ì…˜ ìˆœíšŒ
    for (let line of formation.slice(1)) {
      for (let pos of line) {
        const candidate = pickBestPlayer(pos, fieldPlayers, used);
        if (candidate) {
          lineup.push({pos, name:candidate.name});
          candidate.count++;
          used.add(candidate.name);
        }
      }
    }
    quarters[q] = lineup;
  }

  // ê²°ê³¼ ì¶œë ¥
  let html = '';
  for (let i = 0; i < 4; i++) {
    html += `<div class="quarter"><h3>ğŸ•’ ${i+1}ì¿¼í„° (25ë¶„)</h3><table><tr><th>í¬ì§€ì…˜</th><th>ì´ë¦„</th></tr>`;
    quarters[i].forEach(p => {
      html += `<tr><td>${p.pos}</td><td>${p.name}</td></tr>`;
    });
    html += '</table></div>';
  }

  // ì¶œì „ íšŸìˆ˜ ìš”ì•½ + ë§‰ëŒ€ ê·¸ë˜í”„
  html += '<h3>âš–ï¸ ì¶œì „ ì¿¼í„° ìš”ì•½</h3><table><tr><th>ì´ë¦„</th><th>ì¶œì „ ìˆ˜</th><th>ê·¸ë˜í”„</th></tr>';
  players.forEach(p => {
    const width = (p.count / 4) * 100;
    html += `<tr><td>${p.name}</td><td>${p.count}</td>
    <td><div class="bar" style="width:${width}%;"></div></td></tr>`;
  });
  html += '</table>';

  document.getElementById('result').innerHTML = html;
}

function pickBestPlayer(targetPos, pool, used) {
  const shuffled = [...pool].sort(() => Math.random() - 0.5);
  let best = null;
  for (let p of shuffled) {
    if (used.has(p.name) || p.count >= 3) continue;

    // 1ìˆœìœ„ ì¼ì¹˜
    if (p.pos1 === targetPos) return p;
    // 2ìˆœìœ„ ì¼ì¹˜
    if (p.pos2 === targetPos) best = best || p;
    // ìœ ì‚¬ í¬ì§€ì…˜ ì¼ì¹˜
    if (similarPositions[p.pos1]?.includes(targetPos) || similarPositions[p.pos2]?.includes(targetPos)) {
      best = best || p;
    }
  }
  return best;
}
</script>
</body>
</html>
